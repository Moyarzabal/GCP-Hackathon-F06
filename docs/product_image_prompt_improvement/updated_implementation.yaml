name: å•†å“ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ - æ›´æ–°å®Ÿè£…
description: æ–‡å­—è¡¨ç¤ºå•é¡Œã®è§£æ±ºã¨è³å‘³æœŸé™è¡¨ç¾ã®æ”¹å–„ã‚’å®Ÿè£…ã—ãŸæœ€çµ‚ç‰ˆ
version: "1.0"
date: "2025-09-20"

updated_implementation:
  location: lib/core/services/imagen_service.dart
  methods:
    - _createPrompt: "æ”¹å–„ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆãƒ¡ã‚½ãƒƒãƒ‰"
    - _getCategoryTraits: "æ–°è¦è¿½åŠ ï¼šã‚«ãƒ†ã‚´ãƒªç‰¹å¾´ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ¡ã‚½ãƒƒãƒ‰"

  key_improvements:
    text_prevention:
      implementation: "æ˜ç¤ºçš„ãªãƒ†ã‚­ã‚¹ãƒˆç¦æ­¢æŒ‡ç¤ºã®è¿½åŠ "
      directive: "NO text, letters, words, or product names visible in the image, focus purely on character design and visual representation"
      approach: "å•†å“åã«åŸºã¥ãç”»åƒç”Ÿæˆã‚’ç¶­æŒã—ã¤ã¤ã€æ–‡å­—è¡¨ç¤ºã®ã¿ã‚’é˜²ã"
      
    enhanced_product_representation:
      method: "_getCategoryTraits"
      purpose: "å•†å“åã¨ã‚«ãƒ†ã‚´ãƒªç‰¹å¾´ã‚’çµ„ã¿åˆã‚ã›ãŸè±Šã‹ãªè¡¨ç¾"
      mappings:
        dairy: "creamy white appearance, soft rounded features, gentle curves"
        meat: "rich reddish-brown coloring, hearty robust features, sturdy build"
        vegetable: "fresh green tones, leafy or rounded natural features, organic shapes"
        fruit: "bright vibrant colors, sweet cheerful features, round appealing form"
        grain: "warm golden-brown tones, wholesome sturdy features, comforting appearance"
        seafood: "silvery-blue tones, sleek streamlined features, aquatic essence"
        snack: "colorful playful appearance, fun cheerful features, delightful charm"
        beverage: "refreshing translucent qualities, flowing smooth features, liquid-like grace"
        default: "generic food characteristics, balanced proportions, appealing design"

    enhanced_haze_progression:
      happy_state:
        emoji: "ğŸ˜Š"
        atmosphere: "clear bright atmosphere with no haze, sparkling clean air around character"
        character: "happy and fresh, bright vibrant colors, big smiling face, energetic pose"
        
      neutral_state:
        emoji: "ğŸ˜"
        atmosphere: "light misty atmosphere, subtle haze around character, slightly cloudy background"
        character: "neutral expression with slight concern, gentle pastel colors, thoughtful pose"
        
      worried_state:
        emoji: "ğŸ˜Ÿ"
        atmosphere: "moderate haze surrounding character, cloudy atmosphere, foggy environment"
        character: "worried anxious expression, muted colors, nervous gestures, sweat drops"
        
      panicking_state:
        emoji: "ğŸ˜°"
        atmosphere: "thick dense haze enveloping character, heavy fog atmosphere, ominous misty surroundings"
        character: "very worried panicking expression, darker colors, frantic movements, urgent expression"
        
      expired_state:
        emoji: "ğŸ’€"
        atmosphere: "extremely thick ominous haze, supernatural fog, eerie mist completely surrounding character, haunting atmospheric effects"
        character: "zombie-like expired appearance, dark spooky colors, ghost-like transparency, deteriorated look"

  new_prompt_structure:
    base_template: "Cute kawaii Japanese mascot character representing {productName} ({category} food item) with {categoryTraits} characteristics"
    text_prevention: "NO text, letters, words, or product names visible in the image, focus purely on character design and visual representation"
    emotion_expression: "{specific emotion and character details}"
    atmospheric_effects: "{haze and environmental description}"
    style_specification: "chibi style, simple design"
    additional_details: "{context-specific appearance details}"

  implementation_details:
    method_signature: "_createPrompt(String productName, String emotionState, String category)"
    parameter_usage:
      productName: "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¾ã®åŸºç›¤ã¨ã—ã¦ä½¿ç”¨ï¼ˆæ–‡å­—è¡¨ç¤ºã¯æ˜ç¤ºçš„ã«ç¦æ­¢ï¼‰"
      emotionState: "æ„Ÿæƒ…çŠ¶æ…‹ã¨ã‚‚ã‚„è¡¨ç¾ã®æ±ºå®šã«ä½¿ç”¨"
      category: "è¦–è¦šçš„ç‰¹å¾´ã®æ±ºå®šã«ä½¿ç”¨"
      
    flow:
      1. "ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰è¦–è¦šçš„ç‰¹å¾´ã‚’å–å¾—"
      2. "å•†å“åã¨ã‚«ãƒ†ã‚´ãƒªã‚’çµ„ã¿åˆã‚ã›ãŸãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰"
      3. "ãƒ†ã‚­ã‚¹ãƒˆé˜²æ­¢æŒ‡ç¤ºã®è¿½åŠ "
      4. "æ„Ÿæƒ…çŠ¶æ…‹ã«åŸºã¥ãè©³ç´°ãªè¡¨ç¾ã®è¿½åŠ "
      5. "å®Œæˆã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®è¿”å´"

improvements_achieved:
  text_elimination:
    success_factors:
      - explicit_directive: "æ˜ç¤ºçš„ãªãƒ†ã‚­ã‚¹ãƒˆç¦æ­¢æŒ‡ç¤º"
      - visual_focus_instruction: "è¦–è¦šçš„è¡¨ç¾ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹æŒ‡ç¤º"
      - product_based_character: "å•†å“åã«åŸºã¥ãã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”Ÿæˆã‚’ç¶­æŒ"
      
    expected_results:
      - zero_text_rendering: "ç”»åƒå†…ã®ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¼ãƒ­"
      - product_based_character: "å•†å“åã«åŸºã¥ãé©åˆ‡ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¾"
      - cleaner_visuals: "ã‚ˆã‚Šã‚¯ãƒªãƒ¼ãƒ³ãªè¦–è¦šè¡¨ç¾"
      - consistent_character_focus: "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«é›†ä¸­ã—ãŸç”»åƒ"

  haze_progression_enhancement:
    gradation_levels:
      level_1_happy: "ã‚‚ã‚„ãªã— - ã‚¯ãƒªã‚¢ã§æ˜ã‚‹ã„"
      level_2_neutral: "è»½ã„ã‚‚ã‚„ - å¾®ç´°ãªéœ§"
      level_3_worried: "ä¸­ç¨‹åº¦ã®ã‚‚ã‚„ - æ˜ã‚‰ã‹ãªæ›‡ã‚Š"
      level_4_panicking: "æ¿ƒã„ã‚‚ã‚„ - é‡ã„éœ§"
      level_5_expired: "æ¥µåšã®ã‚‚ã‚„ - ä¸æ°—å‘³ãªéœ§"
      
    visual_impact:
      - clear_expiry_indication: "è³å‘³æœŸé™çŠ¶æ…‹ã®æ˜ç¢ºãªè¦–è¦šçš„è¡¨ç¾"
      - atmospheric_storytelling: "é›°å›²æ°—ã«ã‚ˆã‚‹æ„Ÿæƒ…è¡¨ç¾"
      - progressive_urgency: "æ®µéšçš„ãªç·Šæ€¥åº¦ã®è¡¨ç¾"

  character_appeal_maintenance:
    preserved_elements:
      - kawaii_aesthetic: "ã‹ã‚ã„ã„æ—¥æœ¬é¢¨ã®ç¾å­¦"
      - chibi_style: "ã¡ã³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«"
      - simple_design: "ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³"
      - mascot_character: "ãƒã‚¹ã‚³ãƒƒãƒˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ€§"
      
    enhanced_elements:
      - category_representation: "ã‚«ãƒ†ã‚´ãƒªç‰¹å¾´ã®è¡¨ç¾"
      - emotional_depth: "æ„Ÿæƒ…è¡¨ç¾ã®æ·±åŒ–"
      - atmospheric_integration: "é›°å›²æ°—ã¨ã®çµ±åˆ"

technical_specifications:
  api_compatibility:
    maintained: "Vertex AI Imagen API ã¨ã®äº’æ›æ€§ã‚’ç¶­æŒ"
    parameters: "æ—¢å­˜ã®APIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ä½¿ç”¨"
    
  performance_impact:
    minimal_overhead: "æœ€å°é™ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰"
    cache_compatibility: "æ—¢å­˜ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ã¨äº’æ›"
    
  fallback_system:
    preserved: "æ—¢å­˜ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚’ä¿æŒ"
    enhanced: "æ–°ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹é€ ã«å¯¾å¿œ"

validation_criteria:
  text_prevention_test:
    test_cases:
      - "ã‚Šã‚“ã”" â†’ "æ–‡å­—è¡¨ç¤ºãªã—"
      - "ç‰›ä¹³" â†’ "æ–‡å­—è¡¨ç¤ºãªã—"
      - "ãƒ‘ãƒ³" â†’ "æ–‡å­—è¡¨ç¤ºãªã—"
    success_metric: "100%ãƒ†ã‚­ã‚¹ãƒˆé™¤å»ç‡"
    
  haze_progression_test:
    test_scenarios:
      - happy_to_expired: "æ®µéšçš„ãªã‚‚ã‚„æ¿ƒåº¦ã®å¤‰åŒ–ç¢ºèª"
      - visual_consistency: "è¦–è¦šçš„ä¸€è²«æ€§ã®ç¢ºèª"
      - emotion_correlation: "æ„Ÿæƒ…çŠ¶æ…‹ã¨ã®ç›¸é–¢ç¢ºèª"
    success_metric: "æ˜ç¢ºãª5æ®µéšã®è¦–è¦šçš„å·®ç•°"
    
  character_appeal_test:
    evaluation_points:
      - kawaii_factor: "ã‹ã‚ã„ã•ãƒ¬ãƒ™ãƒ«ã®ç¶­æŒ"
      - recognition: "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èªè­˜æ€§"
      - category_representation: "ã‚«ãƒ†ã‚´ãƒªç‰¹å¾´ã®è¡¨ç¾åº¦"
    success_metric: "æ—¢å­˜ãƒ¬ãƒ™ãƒ«ä»¥ä¸Šã®é­…åŠ›åº¦"

future_enhancements:
  potential_improvements:
    - seasonal_variations: "å­£ç¯€ã«ã‚ˆã‚‹è¡¨ç¾å¤‰åŒ–"
    - cultural_adaptations: "æ–‡åŒ–çš„é©å¿œ"
    - dynamic_backgrounds: "å‹•çš„èƒŒæ™¯è¦ç´ "
    - advanced_emotions: "ã‚ˆã‚Šç´°ã‹ã„æ„Ÿæƒ…è¡¨ç¾"
    
  scalability_considerations:
    - new_categories: "æ–°ã‚«ãƒ†ã‚´ãƒªã®å®¹æ˜“ãªè¿½åŠ "
    - emotion_expansion: "æ„Ÿæƒ…çŠ¶æ…‹ã®æ‹¡å¼µ"
    - localization: "å¤šè¨€èªå¯¾å¿œ"

implementation_notes:
  breaking_changes: "ãªã—ï¼ˆæ—¢å­˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¿æŒï¼‰"
  backward_compatibility: "å®Œå…¨ãªå¾Œæ–¹äº’æ›æ€§"
  migration_required: "ä¸è¦"
  
  deployment_considerations:
    - immediate_effect: "ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œå³åº§ã«åŠ¹æœã‚’ç™ºæ®"
    - cache_refresh: "æ—¢å­˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢ã‚’æ¨å¥¨"
    - monitoring: "ç”Ÿæˆçµæœã®å“è³ªç›£è¦–ã‚’æ¨å¥¨"
