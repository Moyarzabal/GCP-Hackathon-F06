# ğŸ”§ gcloud CLI ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¬ã‚¤ãƒ‰

## æ¦‚è¦
gcloud CLIã‚’ä½¿ç”¨ã—ã¦GCP/Firebaseã®èªè¨¼æƒ…å ±ã¨ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•çš„ã«å–å¾—ãƒ»è¨­å®šã™ã‚‹æ–¹æ³•

## ğŸš€ gcloud CLI ã‹ã‚‰å–å¾—å¯èƒ½ãªæƒ…å ±

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
```bash
# ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID
gcloud config get-value project
# å‡ºåŠ›ä¾‹: gcp-f06-barcode

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è©³ç´°æƒ…å ±
gcloud projects describe $(gcloud config get-value project) --format=json

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç•ªå·
gcloud projects describe $(gcloud config get-value project) --format="value(projectNumber)"
```

### 2. Firebaseè¨­å®šã®å–å¾—
```bash
# Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã‚’å–å¾—
firebase apps:sdkconfig web

# å‡ºåŠ›ä¾‹ï¼ˆJSONå½¢å¼ï¼‰:
# {
#   "apiKey": "AIzaSy...",
#   "authDomain": "gcp-f06-barcode.firebaseapp.com",
#   "projectId": "gcp-f06-barcode",
#   "storageBucket": "gcp-f06-barcode.appspot.com",
#   "messagingSenderId": "762195307431",
#   "appId": "1:762195307431:web:..."
# }

# iOSè¨­å®š
firebase apps:sdkconfig ios

# Androidè¨­å®š
firebase apps:sdkconfig android
```

### 3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ç”Ÿæˆ
```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
gcloud iam service-accounts create flutter-app-sa \
  --display-name="Flutter App Service Account"

# ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ãƒ¼ãƒ«ä»˜ä¸
gcloud projects add-iam-policy-binding $(gcloud config get-value project) \
  --member="serviceAccount:flutter-app-sa@$(gcloud config get-value project).iam.gserviceaccount.com" \
  --role="roles/firebase.admin"

# ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
gcloud iam service-accounts keys create service-account-key.json \
  --iam-account=flutter-app-sa@$(gcloud config get-value project).iam.gserviceaccount.com
```

### 4. API ã‚­ãƒ¼ã®å–å¾—
```bash
# APIã‚­ãƒ¼ä¸€è¦§
gcloud services api-keys list --format=json

# ç‰¹å®šã®APIã‚­ãƒ¼è©³ç´°
gcloud services api-keys describe <KEY_ID> --format=json

# æ–°ã—ã„APIã‚­ãƒ¼ä½œæˆ
gcloud services api-keys create \
  --display-name="Flutter App API Key" \
  --format=json
```

## ğŸ” è‡ªå‹•ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### `scripts/setup_env.sh`
```bash
#!/bin/bash

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å–å¾—
PROJECT_ID=$(gcloud config get-value project)
PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format="value(projectNumber)")
REGION="asia-northeast1"

# Firebaseè¨­å®šã‚’å–å¾—
echo "Fetching Firebase configuration..."
FIREBASE_CONFIG=$(firebase apps:sdkconfig web --json)

# JSONã‹ã‚‰å€¤ã‚’æŠ½å‡º
API_KEY=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.apiKey')
AUTH_DOMAIN=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.authDomain')
STORAGE_BUCKET=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.storageBucket')
MESSAGING_SENDER_ID=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.messagingSenderId')
APP_ID=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.appId')

# .envãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
cat > .env << EOF
# Auto-generated by setup_env.sh
# Generated at: $(date)

# GCP Configuration
GCP_PROJECT_ID=$PROJECT_ID
GCP_PROJECT_NUMBER=$PROJECT_NUMBER
GCP_REGION=$REGION

# Firebase Configuration
FIREBASE_API_KEY=$API_KEY
FIREBASE_AUTH_DOMAIN=$AUTH_DOMAIN
FIREBASE_PROJECT_ID=$PROJECT_ID
FIREBASE_STORAGE_BUCKET=$STORAGE_BUCKET
FIREBASE_MESSAGING_SENDER_ID=$MESSAGING_SENDER_ID
FIREBASE_APP_ID=$APP_ID

# Vertex AI
VERTEX_AI_PROJECT=$PROJECT_ID
VERTEX_AI_LOCATION=$REGION
VERTEX_AI_ENDPOINT=$REGION-aiplatform.googleapis.com

# Service Account
GOOGLE_APPLICATION_CREDENTIALS=./service-account-key.json
EOF

echo "âœ… .env file created successfully!"
```

### `scripts/setup_dart_env.sh`
```bash
#!/bin/bash

# Dartç”¨ã®ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
PROJECT_ID=$(gcloud config get-value project)

# Firebaseè¨­å®šã‚’å–å¾—
FIREBASE_CONFIG=$(firebase apps:sdkconfig web --json)

# å€¤ã‚’æŠ½å‡º
API_KEY=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.apiKey')
AUTH_DOMAIN=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.authDomain')
STORAGE_BUCKET=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.storageBucket')
MESSAGING_SENDER_ID=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.messagingSenderId')
APP_ID=$(echo $FIREBASE_CONFIG | jq -r '.result.sdkConfig.appId')

# Dartç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
cat > lib/core/config/env.dart << EOF
// Auto-generated by setup_dart_env.sh
// DO NOT COMMIT THIS FILE

class Env {
  static const String gcpProjectId = '$PROJECT_ID';
  static const String firebaseApiKey = '$API_KEY';
  static const String firebaseAuthDomain = '$AUTH_DOMAIN';
  static const String firebaseStorageBucket = '$STORAGE_BUCKET';
  static const String firebaseMessagingSenderId = '$MESSAGING_SENDER_ID';
  static const String firebaseAppId = '$APP_ID';
  
  // These need to be set manually or from other sources
  static const String geminiApiKey = String.fromEnvironment('GEMINI_API_KEY', defaultValue: '');
  static const String vapidKey = String.fromEnvironment('VAPID_KEY', defaultValue: '');
}
EOF

echo "âœ… lib/core/config/env.dart created successfully!"
```

## ğŸ¯ Gemini API ã‚­ãƒ¼ã®å–å¾—

Gemini APIã‚­ãƒ¼ã¯gcloud CLIã§ã¯ç›´æ¥å–å¾—ã§ããªã„ãŸã‚ã€åˆ¥é€”å–å¾—ãŒå¿…è¦ï¼š

```bash
# 1. ãƒ–ãƒ©ã‚¦ã‚¶ã§Google AI Studioã‚’é–‹ã
open https://makersuite.google.com/app/apikey

# 2. ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®š
export GEMINI_API_KEY="your-api-key-here"

# 3. .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
echo "GEMINI_API_KEY=$GEMINI_API_KEY" >> .env
```

## ğŸ”„ Application Default Credentials (ADC)

```bash
# ADCã‚’è¨­å®šï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰
gcloud auth application-default login

# ADCã®å ´æ‰€ã‚’ç¢ºèª
echo $GOOGLE_APPLICATION_CREDENTIALS
# ã¾ãŸã¯
gcloud auth application-default print-access-token

# Flutterã‚¢ãƒ—ãƒªã§ä½¿ç”¨
export GOOGLE_APPLICATION_CREDENTIALS="$HOME/.config/gcloud/application_default_credentials.json"
```

## ğŸ“± iOS/Androidç”¨è¨­å®šã®å–å¾—

### iOS
```bash
# iOSç”¨ã®GoogleService-Info.plistã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
firebase apps:sdkconfig ios --out ios/Runner/GoogleService-Info.plist

# ã¾ãŸã¯æ‰‹å‹•ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -o ios/Runner/GoogleService-Info.plist \
  "https://firebase.googleapis.com/v1/projects/$PROJECT_ID/iosApps/<APP_ID>/config"
```

### Android
```bash
# Androidç”¨ã®google-services.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
firebase apps:sdkconfig android --out android/app/google-services.json

# ã¾ãŸã¯æ‰‹å‹•ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -o android/app/google-services.json \
  "https://firebase.googleapis.com/v1/projects/$PROJECT_ID/androidApps/<APP_ID>/config"
```

## ğŸ³ Dockerç’°å¢ƒã§ã®ä½¿ç”¨

```dockerfile
# Dockerfile
FROM google/cloud-sdk:alpine

# gcloudèªè¨¼æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
COPY service-account-key.json /app/
ENV GOOGLE_APPLICATION_CREDENTIALS=/app/service-account-key.json

# ã¾ãŸã¯ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦æ¸¡ã™
ARG GCP_PROJECT_ID
ARG FIREBASE_API_KEY
ENV GCP_PROJECT_ID=$GCP_PROJECT_ID
ENV FIREBASE_API_KEY=$FIREBASE_API_KEY
```

```bash
# Docker buildã§ç’°å¢ƒå¤‰æ•°ã‚’æ¸¡ã™
docker build \
  --build-arg GCP_PROJECT_ID=$(gcloud config get-value project) \
  --build-arg FIREBASE_API_KEY=$(firebase apps:sdkconfig web --json | jq -r '.result.sdkConfig.apiKey') \
  -t myapp .
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

1. **çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„**
   - `.env`
   - `service-account-key.json`
   - `lib/core/config/env.dart`

2. **.gitignoreã«è¿½åŠ **
   ```gitignore
   .env
   *.env
   service-account-key.json
   lib/core/config/env.dart
   ```

3. **CI/CDç’°å¢ƒã§ã®ä½¿ç”¨**
   ```yaml
   # GitHub Actionsä¾‹
   - name: Setup environment
     run: |
       echo "${{ secrets.SERVICE_ACCOUNT_KEY }}" | base64 -d > service-account-key.json
       gcloud auth activate-service-account --key-file=service-account-key.json
       gcloud config set project ${{ secrets.GCP_PROJECT_ID }}
   ```

## ğŸš€ ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼è¨­å®š

ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ã‚’ä¸€åº¦ã«è¨­å®šï¼š

```bash
# å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x scripts/setup_env.sh scripts/setup_dart_env.sh

# ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•è¨­å®š
./scripts/setup_env.sh && ./scripts/setup_dart_env.sh

# Flutter ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œ
flutter run
```

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### gcloudæœªèªè¨¼ã‚¨ãƒ©ãƒ¼
```bash
gcloud auth login
gcloud config set project gcp-f06-barcode
```

### Firebase CLIæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install -g firebase-tools
firebase login
```

### jqã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„
```bash
# macOS
brew install jq

# Linux
sudo apt-get install jq
```

### APIãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„
```bash
# å¿…è¦ãªAPIã‚’æœ‰åŠ¹åŒ–
gcloud services enable firebase.googleapis.com
gcloud services enable firestore.googleapis.com
gcloud services enable identitytoolkit.googleapis.com
```