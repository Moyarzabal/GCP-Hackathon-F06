# 🔥 Firebase 食材データ大量挿入スクリプト

このディレクトリには、デバッグ用にFirestoreに大量の食材データを挿入するためのPythonスクリプトが含まれています。

## 📁 ファイル構成

- `bulk_insert_fridge_products.py` - **冷蔵庫画面用**データ挿入スクリプト（推奨）
- `bulk_insert_products.py` - 基本的な大量データ挿入スクリプト（itemsコレクション用）
- `bulk_insert_with_scenarios.py` - シナリオ別データ挿入スクリプト（itemsコレクション用）
- `requirements.txt` - 必要なPythonライブラリ
- `README.md` - このファイル

## 🛠️ セットアップ

### 1. 必要なライブラリをインストール

```bash
cd scripts
pip3 install -r requirements.txt
```

### 2. Firebase設定の確認

プロジェクトルートに `firebase-service-account.json` が配置されていることを確認してください。

## 🏠 冷蔵庫画面用データ挿入（推奨）

### 実行方法

```bash
python3 bulk_insert_fridge_products.py
```

### 機能

- **冷蔵庫画面対応**: アプリの冷蔵庫画面で表示される`products`コレクションに直接挿入
- **リアルな食材データ**: 10カテゴリ、200種類以上の食材から選択
- **多様な賞味期限**: 1-30日後の期限をランダム設定
- **データクリア機能**: 既存データのクリア機能付き
- **統計表示**: カテゴリ別、期限別の挿入データ統計

### 使用例

```bash
# 冷蔵庫画面用に50個の食材を挿入
python3 bulk_insert_fridge_products.py
# 既存のproductsコレクションをクリアしますか？ (y/N): N
# 挿入する食材の数を入力してください (デフォルト: 100): 50
# 実行しますか？ (y/N): y
```

## 📊 基本的な大量データ挿入（itemsコレクション用）

### 実行方法

```bash
python3 bulk_insert_products.py
```

### 機能

- **自動世帯・ユーザー作成**: テスト用の世帯とユーザーを自動生成
- **リアルな食材データ**: 10カテゴリ、200種類以上の食材から選択
- **多様な賞味期限**: 1-30日後の期限をランダム設定
- **感情状態**: 賞味期限に基づいた適切な感情状態（😊😐😟😰💀）
- **統計表示**: カテゴリ別、状態別の挿入データ統計

### 挿入されるデータ例

```json
{
  "itemId": "uuid-v4",
  "householdId": "世帯ID",
  "productName": "トマト",
  "janCode": "4912345678901",
  "category": "野菜",
  "quantity": 3,
  "unit": "個",
  "expiryDate": "2024-10-15T00:00:00Z",
  "status": "😊",
  "barcode": "1234567890123",
  "price": 300,
  "manufacturer": "地元農家",
  "addedBy": "ユーザーID",
  "addedDate": "SERVER_TIMESTAMP",
  "deletedAt": null
}
```

## 🎯 シナリオ別データ挿入

### 実行方法

```bash
python3 bulk_insert_with_scenarios.py
```

### 利用可能なシナリオ

#### 1. `expiry` - 期限切れ間近シナリオ
- **用途**: 期限切れアラート機能のテスト
- **特徴**: 0-3日後に期限切れの食材中心
- **感情状態**: 😟😰💀が多め
- **推奨数**: 20個

#### 2. `bulk` - 大量在庫シナリオ
- **用途**: 大量購入、業務用食材のテスト
- **特徴**: 5-20個の大量在庫
- **感情状態**: 😊が中心
- **推奨数**: 30個

#### 3. `mixed` - バランス型シナリオ
- **用途**: 一般的な家庭の冷蔵庫をシミュレート
- **特徴**: 期限切れ間近20%、大量在庫30%、通常50%
- **感情状態**: バランス良く配分
- **推奨数**: 50個

## 🔧 カスタマイズ

### 食材カテゴリの追加

`FOOD_CATEGORIES` 辞書に新しいカテゴリと食材を追加：

```python
FOOD_CATEGORIES = {
    "新カテゴリ": [
        "食材1", "食材2", "食材3"
    ],
    # ...
}
```

### メーカー名の追加

`MANUFACTURERS` リストに新しいメーカーを追加：

```python
MANUFACTURERS = [
    "新メーカー1", "新メーカー2"
    # ...
]
```

### 単位の追加

`UNITS` リストに新しい単位を追加：

```python
UNITS = ["個", "本", "新単位"]
```

## 📈 使用例

### 基本的な使用例

```bash
# 100個の食材を挿入
python3 bulk_insert_products.py
# 挿入する食材の数を入力してください (デフォルト: 100): 100
# 実行しますか？ (y/N): y
```

### シナリオ別使用例

```bash
# 期限切れ間近シナリオで20個挿入
python3 bulk_insert_with_scenarios.py
# シナリオを選択してください (expiry/bulk/mixed): expiry
# 世帯ID (空白の場合は新規作成): 
# ユーザーID (空白の場合は新規作成): 
# 挿入する食材の数を入力してください (デフォルト: 20): 20
# 実行しますか？ (y/N): y
```

## 🚨 注意事項

1. **本番環境での実行禁止**: これらのスクリプトはデバッグ・テスト専用です
2. **データ削除**: 大量データを挿入後、不要になったら手動で削除してください
3. **Firebase制限**: Firestoreの読み書き制限に注意してください
4. **重複データ**: 同じスクリプトを複数回実行すると重複データが作成されます

## 🔍 トラブルシューティング

### Firebase接続エラー

```
❌ Firebase接続エラー
```

- `firebase-service-account.json` の配置を確認
- Firebase Admin SDKの権限を確認

### インポートエラー

```
ModuleNotFoundError: No module named 'firebase_admin'
```

- 必要なライブラリをインストール: `pip3 install -r requirements.txt`

### 権限エラー

```
❌ 権限がありません
```

- Firebase サービスアカウントの権限設定を確認
- Firestore の読み書き権限があることを確認

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. Firebase プロジェクトの設定
2. サービスアカウントキーの配置
3. Python環境とライブラリのインストール
4. Firestoreのセキュリティルール

---

**⚠️ 重要**: これらのスクリプトはデバッグ・テスト目的でのみ使用してください。本番環境では使用しないでください。
